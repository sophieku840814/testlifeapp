<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>P 人任務助手 — 優化版</title>
  <style>
    :root {
      --bg: #ffffff;
      --panel: #f9fafb;
      --text: #0f172a;
      --muted: #64748b;
      --accent: #111827;
      --success: #16a34a;
      font-family: "Noto Sans TC", system-ui, sans-serif;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0b1220;
        --panel: #111827;
        --text: #e6eef8;
        --muted: #9aa7b8;
        --accent: #e6eef8;
      }
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: var(--text); display: flex; justify-content: center; padding: 24px; }
    .container { width: 420px; }
    header { margin-bottom: 16px; }
    header h1 { font-size: 20px; margin: 0; font-weight: 700; }
    header p { margin: 0; font-size: 13px; color: var(--muted); }

    /* 輸入區 */
    .input-box { display: flex; gap: 6px; margin-bottom: 16px; }
    input[type=text], input[type=date] { padding: 10px; border-radius: 10px; border: 1px solid #ddd; font-size: 14px; flex: 1; }
    input[type=text]::placeholder { color: var(--muted); }
    button { border: 0; padding: 8px 12px; border-radius: 10px; background: var(--accent); color: white; font-weight: 600; cursor: pointer; }
    .btn-ghost { background: transparent; color: var(--muted); }

    /* 清單區塊 */
    .section { margin-bottom: 18px; }
    .section-title { font-size: 14px; font-weight: 600; margin-bottom: 6px; color: var(--muted); }
    ul { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 6px; }
    .task { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-radius: 10px; background: var(--panel); transition: all .3s ease; }
    .task .left { display: flex; flex-direction: column; }
    .task .title { font-size: 15px; margin: 0; }
    .meta { font-size: 12px; color: var(--muted); }
    .completed .title { color: var(--muted); text-decoration: line-through; }
    .completed .meta { color: var(--success); }
    .task.fade-out { opacity: 0; transform: scale(0.95); }

    /* Toast 通知 */
    #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--accent); color: white; padding: 10px 16px; border-radius: 10px; font-size: 13px; display: none; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>P 人任務助手</h1>
      <p>極簡 • 專注今日 • 不拖延</p>
    </header>

    <div class="input-box">
      <input id="taskInput" type="text" placeholder="輸入任務..." maxlength="120">
      <input id="taskDate" type="date">
      <button id="addBtn">新增</button>
    </div>

    <div class="section">
      <div class="section-title">今日清單 <span id="todayCount"></span></div>
      <ul id="todayList"></ul>
    </div>

    <div class="section">
      <div class="section-title">收件匣</div>
      <ul id="inboxList"></ul>
    </div>

    <div class="section">
      <div class="section-title">已完成</div>
      <ul id="doneList"></ul>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    let tasks = { inbox: [], today: [], done: [] };
    const storageKey = "p_person_tasks";

    function save() { localStorage.setItem(storageKey, JSON.stringify(tasks)); }
    function load() {
      const raw = localStorage.getItem(storageKey);
      if (raw) tasks = JSON.parse(raw);
    }
    function formatDate(d) {
      if (!d) return "";
      const dt = new Date(d);
      return `${dt.getFullYear()}/${String(dt.getMonth()+1).padStart(2,'0')}/${String(dt.getDate()).padStart(2,'0')}`;
    }

    function showToast(msg) {
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.style.display = "block";
      el.style.opacity = "1";
      setTimeout(() => { el.style.opacity = "0"; }, 2000);
      setTimeout(() => { el.style.display = "none"; }, 2500);
    }

    function addTask() {
      const text = document.getElementById("taskInput").value.trim();
      const date = document.getElementById("taskDate").value;
      if (!text) return;
      const t = { id: Date.now(), text, date, created: new Date().toISOString() };
      if (date) tasks.today.unshift(t);
      else tasks.inbox.unshift(t);
      document.getElementById("taskInput").value = "";
      document.getElementById("taskDate").value = "";
      save(); render(); showToast("任務已新增");
    }

    function moveToToday(id) {
      const idx = tasks.inbox.findIndex(t => t.id === id);
      if (idx > -1) {
        const task = tasks.inbox.splice(idx, 1)[0];
        tasks.today.unshift(task);
        save(); render(); showToast("已加入今日");
      }
    }

    function completeTask(id, from) {
      const list = from === "today" ? tasks.today : tasks.inbox;
      const idx = list.findIndex(t => t.id === id);
      if (idx > -1) {
        const task = list.splice(idx, 1)[0];
        task.doneAt = new Date().toISOString();
        tasks.done.unshift(task);
        save(); render(); showToast("完成任務 ✅");
      }
    }

    function deleteTask(id, from) {
      const list = tasks[from];
      const idx = list.findIndex(t => t.id === id);
      if (idx > -1) {
        list.splice(idx, 1);
        save(); render(); showToast("已刪除");
      }
    }

    function render() {
      const todayList = document.getElementById("todayList");
      todayList.innerHTML = tasks.today.map(t => `
        <li class="task">
          <div class="left">
            <div class="title">${t.text}</div>
            <div class="meta">${t.date ? formatDate(t.date) : formatDate(t.created)}</div>
          </div>
          <div>
            <button class="btn-ghost" onclick="deleteTask(${t.id}, 'today')">刪除</button>
            <button onclick="completeTask(${t.id}, 'today')">完成</button>
          </div>
        </li>
      `).join("");
      document.getElementById("todayCount").textContent = `(${tasks.today.length})`;

      const inboxList = document.getElementById("inboxList");
      inboxList.innerHTML = tasks.inbox.map(t => `
        <li class="task">
          <div class="left">
            <div class="title">${t.text}</div>
            <div class="meta">${t.date ? formatDate(t.date) : ""}</div>
          </div>
          <div>
            <button class="btn-ghost" onclick="deleteTask(${t.id}, 'inbox')">刪除</button>
            <button onclick="moveToToday(${t.id})">→ 今日</button>
            <button class="btn-ghost" onclick="completeTask(${t.id}, 'inbox')">完成</button>
          </div>
        </li>
      `).join("");

      const doneList = document.getElementById("doneList");
      doneList.innerHTML = tasks.done.map(t => `
        <li class="task completed">
          <div class="left">
            <div class="title">${t.text}</div>
            <div class="meta">完成於 ${formatDate(t.doneAt)}</div>
          </div>
          <div>
            <button class="btn-ghost" onclick="deleteTask(${t.id}, 'done')">刪除</button>
          </div>
        </li>
      `).join("");
    }

    document.getElementById("addBtn").addEventListener("click", addTask);
    document.getElementById("taskInput").addEventListener("keypress", e => { if (e.key === "Enter") addTask(); });

    load(); render();
  </script>
</body>
</html>
