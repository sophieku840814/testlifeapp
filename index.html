<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>極簡任務工具</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f8f8f8;
    margin: 0; padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h2 { margin-top: 20px; }
  .task-section { 
    background: #fff; 
    padding: 15px; 
    margin: 10px 0; 
    width: 300px; 
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  ul { list-style: none; padding: 0; }
  li { 
    display: flex; 
    justify-content: space-between; 
    padding: 6px 0; 
    border-bottom: 1px solid #eee;
  }
  button { margin-left: 5px; }
  input[type=text] { width: 70%; padding: 5px; }
</style>
</head>
<body>

<h1>極簡任務工具</h1>

<div class="task-section">
  <h2>Inbox (靈感資料庫)</h2>
  <input type="text" id="inboxInput" placeholder="新增靈感...">
  <button onclick="addInboxTask()">加入</button>
  <ul id="inboxList"></ul>
</div>

<div class="task-section">
  <h2>Today (每日任務，最多 3)</h2>
  <input type="text" id="todayInput" placeholder="新增今日任務...">
  <button onclick="addTodayTask()">加入</button>
  <ul id="todayList"></ul>
</div>

<div class="task-section">
  <h2>Done</h2>
  <ul id="doneList"></ul>
</div>

<script>
  const MAX_TODAY = 3;

  // LocalStorage Keys
  const STORAGE_KEYS = {
    inbox: 'tasks_inbox',
    today: 'tasks_today',
    done: 'tasks_done',
    lastDate: 'tasks_last_date'
  }

  // 初始化
  let inboxTasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.inbox)) || [];
  let todayTasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.today)) || [];
  let doneTasks = JSON.parse(localStorage.getItem(STORAGE_KEYS.done)) || [];
  const todayDate = new Date().toISOString().split('T')[0]; // yyyy-mm-dd

  // 每日刷新 Today 任務
  const lastDate = localStorage.getItem(STORAGE_KEYS.lastDate);
  if (lastDate !== todayDate) {
    todayTasks = [];
    localStorage.setItem(STORAGE_KEYS.lastDate, todayDate);
    localStorage.setItem(STORAGE_KEYS.today, JSON.stringify(todayTasks));
  }

  // 渲染函數
  function renderTasks() {
    // Inbox
    const inboxList = document.getElementById('inboxList');
    inboxList.innerHTML = '';
    inboxTasks.forEach((task, index) => {
      const li = document.createElement('li');
      li.textContent = task;
      const btn = document.createElement('button');
      btn.textContent = '→Today';
      btn.onclick = () => moveToToday(index);
      li.appendChild(btn);
      inboxList.appendChild(li);
    });

    // Today
    const todayList = document.getElementById('todayList');
    todayList.innerHTML = '';
    todayTasks.slice(0, MAX_TODAY).forEach((task, index) => {
      const li = document.createElement('li');
      li.textContent = task.title + ' (' + task.date + ')';
      const btn = document.createElement('button');
      btn.textContent = '完成';
      btn.onclick = () => completeToday(index);
      li.appendChild(btn);
      todayList.appendChild(li);
    });

    // Done
    const doneList = document.getElementById('doneList');
    doneList.innerHTML = '';
    doneTasks.forEach(task => {
      const li = document.createElement('li');
      li.textContent = task.title + ' (' + task.date + ')';
      doneList.appendChild(li);
    });
  }

  // 新增 Inbox
  function addInboxTask() {
    const input = document.getElementById('inboxInput');
    if (input.value.trim() !== '') {
      inboxTasks.push(input.value.trim());
      input.value = '';
      localStorage.setItem(STORAGE_KEYS.inbox, JSON.stringify(inboxTasks));
      renderTasks();
    }
  }

  // 新增 Today
  function addTodayTask() {
    const input = document.getElementById('todayInput');
    if (input.value.trim() === '') return;
    if (todayTasks.length >= MAX_TODAY) {
      alert('今日任務已達上限（3 個）');
      return;
    }
    todayTasks.push({ title: input.value.trim(), date: todayDate });
    input.value = '';
    localStorage.setItem(STORAGE_KEYS.today, JSON.stringify(todayTasks));
    renderTasks();
  }

  // Inbox → Today
  function moveToToday(index) {
    if (todayTasks.length >= MAX_TODAY) {
      alert('今日任務已達上限（3 個）');
      return;
    }
    const taskTitle = inboxTasks.splice(index, 1)[0];
    todayTasks.push({ title: taskTitle, date: todayDate });
    localStorage.setItem(STORAGE_KEYS.inbox, JSON.stringify(inboxTasks));
    localStorage.setItem(STORAGE_KEYS.today, JSON.stringify(todayTasks));
    renderTasks();
  }

  // 完成 Today 任務
  function completeToday(index) {
    const task = todayTasks.splice(index, 1)[0];
    doneTasks.push(task);
    localStorage.setItem(STORAGE_KEYS.today, JSON.stringify(todayTasks));
    localStorage.setItem(STORAGE_KEYS.done, JSON.stringify(doneTasks));
    renderTasks();
  }

  renderTasks();
</script>

</body>
</html>
