<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>極簡任務工具</title>
<style>
  body { font-family: Arial, sans-serif; background: #f8f8f8; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
  h2 { margin-top: 20px; }
  .task-section { background: #fff; padding: 15px; margin: 10px 0; width: 300px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
  ul { list-style: none; padding: 0; }
  li { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee; }
  button { margin-left: 5px; }
  input[type=text] { width: 70%; padding: 5px; }
</style>
</head>
<body>

<h1>極簡任務工具</h1>

<div class="task-section">
  <h2>Inbox (靈感資料庫)</h2>
  <input type="text" id="inboxInput" placeholder="新增靈感...">
  <button onclick="addInboxTask()">加入</button>
  <ul id="inboxList"></ul>
</div>

<div class="task-section">
  <h2>Today (每日任務，最多 3)</h2>
  <input type="text" id="todayInput" placeholder="新增今日任務...">
  <button onclick="addTodayTask()">加入</button>
  <ul id="todayList"></ul>
</div>

<div class="task-section">
  <h2>Done</h2>
  <ul id="doneList"></ul>
</div>

<script>
const MAX_TODAY = 3;
const API_URL = 'http://localhost:3000'; // 上線後改成你的域名
const todayDate = new Date().toISOString().split('T')[0];

let inboxTasks = [];
let todayTasks = [];
let doneTasks = [];

function loadTasks() {
  fetch(`${API_URL}/tasks?type=inbox`).then(res=>res.json()).then(data=>{inboxTasks=data; renderTasks();});
  fetch(`${API_URL}/tasks?type=today`).then(res=>res.json()).then(data=>{todayTasks=data; renderTasks();});
  fetch(`${API_URL}/tasks?type=done`).then(res=>res.json()).then(data=>{doneTasks=data; renderTasks();});
}

function renderTasks() {
  const inboxList = document.getElementById('inboxList');
  inboxList.innerHTML = '';
  inboxTasks.forEach(task=>{
    const li = document.createElement('li');
    li.textContent = task.title;
    const btn = document.createElement('button');
    btn.textContent = '→Today';
    btn.onclick = ()=>moveToToday(task.id);
    li.appendChild(btn);
    inboxList.appendChild(li);
  });

  const todayList = document.getElementById('todayList');
  todayList.innerHTML = '';
  todayTasks.slice(0, MAX_TODAY).forEach(task=>{
    const li = document.createElement('li');
    li.textContent = task.title + ' (' + task.date + ')';
    const btn = document.createElement('button');
    btn.textContent = '完成';
    btn.onclick = ()=>completeToday(task.id);
    li.appendChild(btn);
    todayList.appendChild(li);
  });

  const doneList = document.getElementById('doneList');
  doneList.innerHTML = '';
  doneTasks.forEach(task=>{
    const li = document.createElement('li');
    li.textContent = task.title + ' (' + task.date + ')';
    doneList.appendChild(li);
  });
}

// 新增 Inbox
function addInboxTask() {
  const input=document.getElementById('inboxInput');
  if(input.value.trim()==='') return;
  fetch(`${API_URL}/tasks`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({title:input.value.trim(),type:'inbox',date:todayDate})
  }).then(()=>{input.value=''; loadTasks();});
}

// 新增 Today
function addTodayTask() {
  if(todayTasks.length>=MAX_TODAY){alert('今日任務已達上限（3個）');return;}
  const input=document.getElementById('todayInput');
  if(input.value.trim()==='') return;
  fetch(`${API_URL}/tasks`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({title:input.value.trim(),type:'today',date:todayDate})
  }).then(()=>{input.value=''; loadTasks();});
}

// Inbox → Today
function moveToToday(id){
  if(todayTasks.length>=MAX_TODAY){alert('今日任務已達上限（3個）'); return;}
  fetch(`${API_URL}/tasks/${id}`,{
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({type:'today'})
  }).then(()=>loadTasks());
}

// Today → Done
function completeToday(id){
  fetch(`${API_URL}/tasks/${id}`,{
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({type:'done'})
  }).then(()=>loadTasks());
}

loadTasks();
</script>

</body>
</html>
